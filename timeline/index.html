<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Nested Pie Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .main-container {
            display: flex;
            width: 100%;
            height: 80vh;
            position: relative;
        }
        .sidebar {
            position: absolute;
            left: -350px;
            height: 100%;
            width: 350px;
            overflow-y: auto;
            background-color: #f8f8f8;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: left 0.3s ease;
            z-index: 100;
        }
        .sidebar.active {
            left: 0;
        }
        .sidebar-content {
            padding: 20px;
            position: relative;
        }
        .sidebar-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
            border: none;
            font-size: 16px;
        }
        .sidebar-close:hover {
            background-color: #d0d0d0;
        }
        .sidebar-image {
            width: 100%;
            height: auto;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .sidebar-title {
            font-size: 24px;
            margin-bottom: 15px;
            padding-right: 40px;
            color: #333;
        }
        .sidebar-subtitle {
            font-size: 18px;
            margin-bottom: 10px;
            color: #555;
        }
        .sidebar-text {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        #chart-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
        }
        svg {
            width: 100%;
            height: 100%;
            margin: 0 auto;
        }
        .segment {
            cursor: pointer;
            transition: opacity 0.3s;
        }
        .segment:hover {
            opacity: 0.8;
        }
        .tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        .content-tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 5px;
        }
        .tab-button {
            padding: 8px 12px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .tab-button.active {
            background-color: #4169E1;
            color: white;
            border-color: #4169E1;
        }
        .tab-button:hover:not(.active) {
            background-color: #e0e0e0;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <h1>Interactive Nested Pie Chart</h1>
    
    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-content" id="sidebar-content">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
        
        <div id="chart-container"></div>
    </div>
    
    <div class="legend" id="legend"></div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Function to calculate responsive dimensions
        function getResponsiveDimensions() {
            const container = document.getElementById('chart-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            const size = Math.min(width, height);
            return {
                width: size,
                height: size,
                centerX: size / 2,
                centerY: size / 2
            };
        }
        
        // Configuration
        const config = {
            ...getResponsiveDimensions(),
            // Rings data with content for sidebar
            rings: [
                {
                    name: "Humanity's Dream of Flight",
                    radius: 200,
                    color: "#8A2BE2",
                    segments: 3,
                    segmentNames: ["500s BCE to 1599s CE", "1600 CE to 1799s CE", "1800s CE to 1945 CE"],
                    segmentContent: [
                        {
                            title: "Humanity's Dream of Flight",
                            subtitle: "500s BCE to 1599s CE",
                            content: [
                                {
                                    title: "The Myth of Icarus and Daedalus",
                                    subtitle: "500s BCE", 
                                    text: "This is the first segment of the purple outer ring discussing humanity's early dreams of flight through mythology. The story of Icarus and Daedalus represents one of the earliest human expressions of the desire to fly.",
                                    imageSrc: "/api/placeholder/400/250"
                                },
                                {
                                    title: "Secondary Analysis",
                                    text: "Additional analysis for Purple Section A shows increasing engagement metrics over the past quarter. User retention is up by 15% and customer satisfaction scores have improved significantly.",
                                    imageSrc: "/api/placeholder/400/250"
                                },
                                {
                                    title: "Future Projections",
                                    text: "Based on current trends, we project continued growth in this segment. The roadmap includes three major feature releases that should further accelerate adoption and engagement.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        },
                        {
                            title: "Humanity's Dream of Flight",
                            subtitle: "1600 CE to 1799s CE",
                            content: [
                                {
                                    title: "Early Flight Experiments",
                                    subtitle: "1600s-1700s",
                                    text: "The second segment of the purple outer ring focuses on early scientific approaches to flight. This period saw the first serious attempts to understand the principles of aviation and aerodynamics.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        },
                        {
                            title: "Humanity's Dream of Flight",
                            subtitle: "1800s CE to 1945 CE",
                            content: [
                                {
                                    title: "The Age of Aviation",
                                    subtitle: "1800s-1945",
                                    text: "The third segment of the purple ring covers the birth of modern aviation. This segment represents the breakthrough period when human flight became reality, from early gliders to powered aircraft and eventually jet engines.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        }
                    ]
                },
                // Connector ring between Purple and Blue
                {
                    name: "Purple-Blue Connector",
                    radius: 175,
                    color: "#7D59D9", // Mix of purple and blue
                    isConnector: true,
                    arrowCount: 12, // Number of arrows around the circle
                    thickness: 5 // Thickness of the connector ring
                },
                {
                    name: "Blue",
                    radius: 150,
                    color: "#4169E1",
                    segments: 4,
                    segmentNames: ["Blue 1", "Blue 2", "Blue 3", "Blue 4"],
                    segmentContent: [
                        {
                            title: "Blue Section 1",
                            subtitle: "Second Ring - First Segment",
                            content: [
                                {
                                    title: "Blue Section 1 Detail",
                                    text: "The first segment of the blue ring represents subcategory A-1. This section contains detailed metrics about specific projects, teams, and initiatives within this subcategory.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        },
                        {
                            title: "Blue Section 2",
                            subtitle: "Second Ring - Second Segment",
                            content: [
                                {
                                    title: "Blue Section 2 Detail",
                                    text: "The second segment of the blue ring focuses on subcategory A-2. Here we can see performance metrics, resource allocation, and timeline projections for ongoing projects.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        },
                        {
                            title: "Blue Section 3", 
                            subtitle: "Second Ring - Third Segment",
                            content: [
                                {
                                    title: "Blue Section 3 Detail",
                                    text: "Blue section 3 represents subcategory A-3, highlighting our third major focus area. The data shows comparative analysis between current and previous quarters with trend indicators.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        },
                        {
                            title: "Blue Section 4",
                            subtitle: "Second Ring - Fourth Segment",
                            content: [
                                {
                                    title: "Blue Section 4 Detail",
                                    text: "The fourth segment of the blue ring covers subcategory A-4. This section aggregates feedback data and satisfaction scores from multiple sources, providing a comprehensive overview.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        }
                    ]
                },
                // Connector ring between Blue and Green
                {
                    name: "Blue-Green Connector",
                    radius: 125,
                    color: "#3A98B9", // Mix of blue and green
                    isConnector: true,
                    arrowCount: 8, // Number of arrows around the circle
                    thickness: 5 // Thickness of the connector ring
                },
                {
                    name: "Green",
                    radius: 100,
                    color: "#32CD32",
                    segments: 3,
                    segmentNames: ["Green I", "Green II", "Green III"],
                    segmentContent: [
                        {
                            title: "Green Section I",
                            subtitle: "Third Ring - First Segment",
                            content: [
                                {
                                    title: "Green Section I Detail",
                                    text: "The first segment of the green ring focuses on implementation details and technical specifics. This section provides in-depth analysis of operational data and system performance.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        },
                        {
                            title: "Green Section II",
                            subtitle: "Third Ring - Second Segment",
                            content: [
                                {
                                    title: "Green Section II Detail",
                                    text: "Green section 2 represents our financial metrics and resource utilization data. The visualizations here track budget allocation, expenditures, and return on investment across different initiatives.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        },
                        {
                            title: "Green Section III",
                            subtitle: "Third Ring - Third Segment",
                            content: [
                                {
                                    title: "Green Section III Detail",
                                    text: "The third segment of the green ring contains information about market analysis and competitive positioning. This section highlights our strengths, opportunities, and areas for improvement.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        }
                    ]
                },
                // Connector ring between Green and Red
                {
                    name: "Green-Red Connector",
                    radius: 75,
                    color: "#91B93A", // Mix of green and red
                    isConnector: true,
                    arrowCount: 6, // Number of arrows around the circle
                    thickness: 4 // Thickness of the connector ring
                },
                {
                    name: "Red (Inner)",
                    radius: 50,
                    color: "#FF4500",
                    segments: 1,
                    segmentNames: ["Core"],
                    segmentContent: [
                        {
                            title: "Red Center",
                            subtitle: "Core Element",
                            content: [
                                {
                                    title: "Core Values",
                                    text: "The red center circle represents our core values and mission. It sits at the heart of everything we do and connects all the other elements in our organizational structure. This central element emphasizes our commitment to quality, innovation, and customer satisfaction.",
                                    imageSrc: "/api/placeholder/400/250"
                                }
                            ]
                        }
                    ]
                }
            ]
        };
        
        // Create SVG element
        function createChart() {
            // Update dimensions based on current container size
            const dimensions = getResponsiveDimensions();
            config.width = dimensions.width;
            config.height = dimensions.height;
            config.centerX = dimensions.centerX;
            config.centerY = dimensions.centerY;
            
            // Adjust ring radiuses to provide more space for labels
            const maxRadius = Math.min(config.width, config.height) / 2 * 0.85;
            const originalOuterRadius = 200;
            const scale = maxRadius / originalOuterRadius;
            
            config.rings.forEach((ring, i) => {
                // Scale all radiuses proportionally
                ring.radius = ring.radius * scale;
                
                // For connector rings, also scale the thickness
                if (ring.isConnector && ring.thickness) {
                    ring.thickness = ring.thickness * scale;
                }
            });
            
            const container = document.getElementById('chart-container');
            container.innerHTML = '';
            
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("viewBox", `0 0 ${config.width} ${config.height}`);
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            container.appendChild(svg);
            
            // Create rings from outer to inner
            config.rings.forEach((ring, ringIndex) => {
                // Handle connector rings with arrows
                if (ring.isConnector) {
                    const outerRadius = ring.radius + (ring.thickness / 2);
                    const innerRadius = ring.radius - (ring.thickness / 2);
                    
                    // Create connector ring
                    const connectorRing = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    connectorRing.setAttribute("cx", config.centerX);
                    connectorRing.setAttribute("cy", config.centerY);
                    connectorRing.setAttribute("r", ring.radius);
                    connectorRing.setAttribute("fill", "none");
                    connectorRing.setAttribute("stroke", ring.color);
                    connectorRing.setAttribute("stroke-width", ring.thickness);
                    connectorRing.classList.add("connector");
                    
                    svg.appendChild(connectorRing);
                    
                    // Create arrows pointing inward
                    const arrowCount = ring.arrowCount || 8;
                    const arrowLength = ring.thickness * 2.5;
                    const arrowWidth = ring.thickness * 0.8;
                    
                    for (let i = 0; i < arrowCount; i++) {
                        const angle = (i * 360 / arrowCount) * Math.PI / 180;
                        
                        // Calculate arrow position
                        const baseX = config.centerX + ring.radius * Math.cos(angle);
                        const baseY = config.centerY + ring.radius * Math.sin(angle);
                        
                        // Calculate arrow points
                        const tipX = config.centerX + (ring.radius - arrowLength/2) * Math.cos(angle);
                        const tipY = config.centerY + (ring.radius - arrowLength/2) * Math.sin(angle);
                        
                        // Calculate arrow wing points (perpendicular to radius)
                        const perpAngle = angle + Math.PI/2;
                        const wingWidth = arrowWidth / 2;
                        
                        const wing1X = baseX + wingWidth * Math.cos(perpAngle);
                        const wing1Y = baseY + wingWidth * Math.sin(perpAngle);
                        const wing2X = baseX - wingWidth * Math.cos(perpAngle);
                        const wing2Y = baseY - wingWidth * Math.sin(perpAngle);
                        
                        // Create arrow path
                        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        const arrowD = `M ${wing1X} ${wing1Y} L ${baseX} ${baseY} L ${wing2X} ${wing2Y} L ${tipX} ${tipY} Z`;
                        
                        arrowPath.setAttribute("d", arrowD);
                        arrowPath.setAttribute("fill", ring.color);
                        arrowPath.classList.add("arrow");
                        
                        svg.appendChild(arrowPath);
                    }
                } else {
                    const segmentAngle = 360 / ring.segments;
                    
                    for (let i = 0; i < ring.segments; i++) {
                        const startAngle = (i * segmentAngle) % 360;
                        const endAngle = ((i + 1) * segmentAngle) % 360;
                        
                        // For single segment rings (like the red inner circle), create a full circle
                        if (ring.segments === 1) {
                            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                            circle.setAttribute("cx", config.centerX);
                            circle.setAttribute("cy", config.centerY);
                            circle.setAttribute("r", ring.radius);
                            circle.setAttribute("fill", ring.color);
                            circle.classList.add("segment");
                            circle.dataset.name = ring.segmentNames[i];
                            circle.dataset.ring = ring.name;
                            
                            circle.addEventListener("mousemove", showTooltip);
                            circle.addEventListener("mouseleave", hideTooltip);
                            circle.addEventListener("click", function() {
                                showSidebar(ringIndex, i);
                            });
                            
                            // Add label for center circle
                            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                            text.setAttribute("x", config.centerX);
                            text.setAttribute("y", config.centerY);
                            text.setAttribute("text-anchor", "middle");
                            text.setAttribute("dominant-baseline", "middle");
                            text.setAttribute("fill", "#fff");
                            text.setAttribute("font-size", ring.radius / 3);
                            text.setAttribute("font-weight", "bold");
                            text.setAttribute("pointer-events", "none");
                            text.textContent = ring.segmentNames[i];
                            
                            svg.appendChild(circle);
                            svg.appendChild(text);
                        } else {
                            // Find the next non-connector ring for inner radius
                            let innerRadiusRing = null;
                            for (let j = ringIndex + 1; j < config.rings.length; j++) {
                                if (!config.rings[j].isConnector) {
                                    innerRadiusRing = config.rings[j];
                                    break;
                                }
                            }
                            
                            // For multi-segment rings, create arcs
                            const outerRadius = ring.radius;
                            const innerRadius = innerRadiusRing ? innerRadiusRing.radius : 0;
                            
                            // Convert degrees to radians for SVG arc
                            let startRad = (startAngle - 90) * Math.PI / 180;
                            let endRad = (endAngle - 90) * Math.PI / 180;
                            
                            // Calculate angle span
                            const angleSpan = endAngle > startAngle ? endAngle - startAngle : endAngle + 360 - startAngle;
                            const largeArcFlag = angleSpan > 180 ? 1 : 0;
                            
                            // Calculate points
                            const x1 = config.centerX + innerRadius * Math.cos(startRad);
                            const y1 = config.centerY + innerRadius * Math.sin(startRad);
                            const x2 = config.centerX + outerRadius * Math.cos(startRad);
                            const y2 = config.centerY + outerRadius * Math.sin(startRad);
                            const x3 = config.centerX + outerRadius * Math.cos(endRad);
                            const y3 = config.centerY + outerRadius * Math.sin(endRad);
                            const x4 = config.centerX + innerRadius * Math.cos(endRad);
                            const y4 = config.centerY + innerRadius * Math.sin(endRad);
                            
                            // Create path for arc
                            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                            
                            // Define SVG path
                            const d = [
                                `M ${x2} ${y2}`,
                                `A ${outerRadius} ${outerRadius} 0 ${largeArcFlag} 1 ${x3} ${y3}`,
                                `L ${x4} ${y4}`,
                                `A ${innerRadius} ${innerRadius} 0 ${largeArcFlag} 0 ${x1} ${y1}`,
                                "Z"
                            ].join(" ");
                            
                            path.setAttribute("d", d);
                            path.setAttribute("fill", ring.color);
                            path.classList.add("segment");
                            path.dataset.name = ring.segmentNames[i];
                            path.dataset.ring = ring.name;
                            
                            // Slightly lighten or darken segments for better visibility
                            const brightness = 1 + (i % 2 === 0 ? 0.15 : -0.15);
                            path.style.filter = `brightness(${brightness})`;
                            
                            path.addEventListener("mousemove", showTooltip);
                            path.addEventListener("mouseleave", hideTooltip);
                            path.addEventListener("click", function() {
                                showSidebar(ringIndex, i);
                            });
                            
                            svg.appendChild(path);
                            
                            // Add segment label with improved positioning
                            if (outerRadius - innerRadius > 30 && angleSpan > 30) {
                                // Use the exact center angle of the segment for more accurate placement
                                const midAngle = startAngle + (angleSpan / 2);
                                const midRad = (midAngle - 90) * Math.PI / 180; // -90 to align with SVG coordinate system
                                
                                // Calculate optimal radius for text - slightly biased toward outer edge for better visibility
                                const textRadius = innerRadius + (outerRadius - innerRadius) * 0.6;
                                const textX = config.centerX + textRadius * Math.cos(midRad);
                                const textY = config.centerY + textRadius * Math.sin(midRad);
                                
                                // Calculate text rotation for natural reading
                                let rotationDegrees = midAngle;
                                
                                // Adjust rotation so text is never upside down
                                if (rotationDegrees > 90 && rotationDegrees < 270) {
                                    rotationDegrees += 180;
                                }
                                
                                // Create shadow/background text for better visibility
                                const textShadow = document.createElementNS("http://www.w3.org/2000/svg", "text");
                                textShadow.setAttribute("x", textX);
                                textShadow.setAttribute("y", textY);
                                textShadow.setAttribute("text-anchor", "middle");
                                textShadow.setAttribute("dominant-baseline", "middle");
                                textShadow.setAttribute("stroke", "rgba(0,0,0,0.5)");
                                textShadow.setAttribute("stroke-width", "3");
                                textShadow.setAttribute("stroke-linejoin", "round");
                                textShadow.setAttribute("font-size", Math.min(14, (outerRadius - innerRadius) / 4));
                                textShadow.setAttribute("font-weight", "bold");
                                textShadow.setAttribute("pointer-events", "none");
                                textShadow.textContent = ring.segmentNames[i];
                                textShadow.setAttribute("transform", `rotate(${rotationDegrees}, ${textX}, ${textY})`);
                                
                                // Create actual text that will be visible
                                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                                text.setAttribute("x", textX);
                                text.setAttribute("y", textY);
                                text.setAttribute("text-anchor", "middle");
                                text.setAttribute("dominant-baseline", "middle");
                                text.setAttribute("fill", "#fff");
                                text.setAttribute("font-size", Math.min(14, (outerRadius - innerRadius) / 4));
                                text.setAttribute("font-weight", "bold");
                                text.setAttribute("pointer-events", "none");
                                text.setAttribute("transform", `rotate(${rotationDegrees}, ${textX}, ${textY})`);
                                text.textContent = ring.segmentNames[i];
                                
                                svg.appendChild(textShadow);
                                svg.appendChild(text);
                            }
                        }
                    }
                }
            });
            
            // Create legend
            createLegend();
        }
        
        function createLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = '';
            
            config.rings.forEach(ring => {
                // Skip connector rings in the legend
                if (ring.isConnector) return;
                
                ring.segmentNames.forEach((name, i) => {
                    const item = document.createElement('div');
                    item.className = 'legend-item';
                    
                    const colorBox = document.createElement('div');
                    colorBox.className = 'legend-color';
                    colorBox.style.backgroundColor = ring.color;
                    
                    // Apply the same brightness filter as in the chart
                    if (ring.segments > 1) {
                        const brightness = 1 + (i % 2 === 0 ? 0.15 : -0.15);
                        colorBox.style.filter = `brightness(${brightness})`;
                    }
                    
                    const label = document.createElement('span');
                    label.textContent = `${ring.name}: ${name}`;
                    
                    item.appendChild(colorBox);
                    item.appendChild(label);
                    legend.appendChild(item);
                });
            });
        } // Added the missing closing brace here
        
        function showTooltip(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = 1;
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY + 10 + 'px';
            
            const segment = event.target;
            tooltip.textContent = `${segment.dataset.ring}: ${segment.dataset.name}`;
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = 0;
        }
        
        // Function to show sidebar with content
        function showSidebar(ringIndex, segmentIndex) {
            const sidebar = document.getElementById('sidebar');
            const sidebarContent = document.getElementById('sidebar-content');
            
            // Get content for this segment
            const ring = config.rings[ringIndex];
            const segmentData = ring.segmentContent[segmentIndex];
            
            // Check if we have multiple content items
            const hasMultipleContent = segmentData.content && Array.isArray(segmentData.content);
            
            let contentHTML = `
                <button class="sidebar-close" id="close-sidebar">&times;</button>
                <h2 class="sidebar-title">${segmentData.title}</h2>
                <h3 class="sidebar-subtitle">${segmentData.subtitle}</h3>
            `;
            
            if (hasMultipleContent) {
                // Create tabs for multiple content items
                contentHTML += `<div class="content-tabs">`;
                segmentData.content.forEach((item, idx) => {
                    contentHTML += `<button class="tab-button ${idx === 0 ? 'active' : ''}" data-tab="${idx}">${item.title}</button>`;
                });
                contentHTML += `</div><div class="tab-content">`;
                
                // Create content sections
                segmentData.content.forEach((item, idx) => {
                    contentHTML += `
                        <div class="content-section ${idx === 0 ? 'active' : ''}" data-tab="${idx}">
                            <img class="sidebar-image" src="${item.imageSrc}" alt="${item.title}">
                            <p class="sidebar-text">${item.text}</p>
                        </div>
                    `;
                });
                contentHTML += `</div>`;
            } else {
                // This case shouldn't happen anymore since we've standardized all segments to use content array
                console.warn("Segment without content array found. This format is deprecated.");
                return;
            }
            
// Set the HTML content
            sidebarContent.innerHTML = contentHTML;
            
            // Show sidebar
            sidebar.classList.add('active');
            
            // Add event listener to close button
            document.getElementById('close-sidebar').addEventListener('click', closeSidebar);
            
            // Add tab switching functionality if needed
            if (hasMultipleContent) {
                const tabButtons = sidebarContent.querySelectorAll('.tab-button');
                tabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const tabIndex = this.getAttribute('data-tab');
                        
                        // Update active tab button
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Update active content section
                        const contentSections = sidebarContent.querySelectorAll('.content-section');
                        contentSections.forEach(section => {
                            section.classList.remove('active');
                            if (section.getAttribute('data-tab') === tabIndex) {
                                section.classList.add('active');
                            }
                        });
                    });
                });
            }
            
            // Prevent propagation of clicks inside the sidebar
            sidebar.addEventListener('click', function(event) {
                event.stopPropagation();
            });
            
            // Add click event to close sidebar when clicking elsewhere
            setTimeout(() => {
                document.addEventListener('click', closeSidebarOnClickOutside);
            }, 10);
        }
        
        // Function to close sidebar when clicking outside
        function closeSidebarOnClickOutside(event) {
            const sidebar = document.getElementById('sidebar');
            const clickedInsideSidebar = sidebar.contains(event.target);
            const clickedOnSegment = event.target.classList.contains('segment');
            
            if (!clickedInsideSidebar && !clickedOnSegment) {
                closeSidebar();
            }
        }
        
        // Function to close sidebar
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.remove('active');
            document.removeEventListener('click', closeSidebarOnClickOutside);
        }
        
        // Initialize chart
        document.addEventListener('DOMContentLoaded', () => {
            createChart();
            
            // Make chart responsive to window resizing
            window.addEventListener('resize', () => {
                createChart();
            });
        });
    </script>
</body>
</html>
