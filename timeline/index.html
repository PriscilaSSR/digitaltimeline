<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Nested Pie Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .main-container {
            display: flex;
            width: 100%;
            height: 80vh;
            position: relative;
        }
        .sidebar {
            position: absolute;
            left: -350px;
            height: 100%;
            width: 350px;
            overflow-y: auto;
            background-color: #f8f8f8;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: left 0.3s ease;
            z-index: 100;
        }
        .sidebar.active {
            left: 0;
        }
        .sidebar-content {
            padding: 20px;
            position: relative;
        }
        .sidebar-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
            border: none;
            font-size: 16px;
        }
        .sidebar-close:hover {
            background-color: #d0d0d0;
        }
        .sidebar-image {
            width: 100%;
            height: auto;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .sidebar-title {
            font-size: 24px;
            margin-bottom: 15px;
            padding-right: 40px;
            color: #333;
        }
        .sidebar-subtitle {
            font-size: 18px;
            margin-bottom: 10px;
            color: #555;
        }
        .sidebar-text {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        #chart-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
        }
        svg {
            width: 100%;
            height: 100%;
            margin: 0 auto;
        }
        .segment {
            cursor: pointer;
            transition: opacity 0.3s;
        }
        .segment:hover {
            opacity: 0.8;
        }
        .tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Interactive Nested Pie Chart</h1>
    
    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-content" id="sidebar-content">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
        
        <div id="chart-container"></div>
    </div>
    
    <div class="controls">
        <button id="rotate-left">Rotate Left</button>
        <button id="rotate-right">Rotate Right</button>
        <button id="reset">Reset</button>
    </div>
    
    <div class="legend" id="legend"></div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Function to calculate responsive dimensions
        function getResponsiveDimensions() {
            const container = document.getElementById('chart-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            const size = Math.min(width, height);
            return {
                width: size,
                height: size,
                centerX: size / 2,
                centerY: size / 2
            };
        }
        
        // Configuration
        const config = {
            ...getResponsiveDimensions(),
            rotation: 0,
            rings: [
                {
                    name: "Humanity's Dream of Flight",
                    radius: 200,
                    color: "#8A2BE2",
                    segments: 3,
                    segmentNames: ["500s BCE to 1599s CE", "Purple Section 2", "Purple Section 3"],
                    segmentContent: [
                {
                    title: "Purple Section 1", // Edit this
                    subtitle: "Outer Ring - First Segment", // Edit this
                    text: "This is the first segment of the purple outer ring...", // Edit this
                    imageSrc: "/api/placeholder/400/250" // You can keep this placeholder or change to a different image
                },
                },
                {
                    name: "Blue",
                    radius: 150,
                    color: "#4169E1",
                    segments: 4,
                    segmentNames: ["Blue Section 1", "Blue Section 2", "Blue Section 3", "Blue Section 4"]
                },
                {
                    name: "Green",
                    radius: 100,
                    color: "#32CD32",
                    segments: 3,
                    segmentNames: ["Green Section 1", "Green Section 2", "Green Section 3"]
                },
                {
                    name: "Red (Inner)",
                    radius: 50,
                    color: "#FF4500",
                    segments: 1,
                    segmentNames: ["Red Center"]
                }
            ]
        };
        
        // Create SVG element
        function createChart() {
            // Update dimensions based on current container size
            const dimensions = getResponsiveDimensions();
            config.width = dimensions.width;
            config.height = dimensions.height;
            config.centerX = dimensions.centerX;
            config.centerY = dimensions.centerY;
            
            // Adjust ring radiuses proportionally to the new size
            const maxRadius = Math.min(config.width, config.height) / 2 * 0.9;
            const originalOuterRadius = 200;
            const scale = maxRadius / originalOuterRadius;
            
            config.rings.forEach((ring, i) => {
                const originalRadius = [200, 150, 100, 50][i];
                ring.radius = originalRadius * scale;
            });
            
            const container = document.getElementById('chart-container');
            container.innerHTML = '';
            
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("viewBox", `0 0 ${config.width} ${config.height}`);
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            container.appendChild(svg);
            
            // Create rings from outer to inner
            config.rings.forEach((ring, ringIndex) => {
                const segmentAngle = 360 / ring.segments;
                
                for (let i = 0; i < ring.segments; i++) {
                    const startAngle = (i * segmentAngle + config.rotation) % 360;
                    const endAngle = ((i + 1) * segmentAngle + config.rotation) % 360;
                    
                    // For single segment rings (like the red inner circle), create a full circle
                    if (ring.segments === 1) {
                        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                        circle.setAttribute("cx", config.centerX);
                        circle.setAttribute("cy", config.centerY);
                        circle.setAttribute("r", ring.radius);
                        circle.setAttribute("fill", ring.color);
                        circle.classList.add("segment");
                        circle.dataset.name = ring.segmentNames[i];
                        circle.dataset.ring = ring.name;
                        
                        circle.addEventListener("mousemove", showTooltip);
                        circle.addEventListener("mouseleave", hideTooltip);
                        circle.addEventListener("click", function() {
                            showSidebar(ringIndex, i);
                        });
                        
                        svg.appendChild(circle);
                    } else {
                        // For multi-segment rings, create arcs
                        const outerRadius = ring.radius;
                        const innerRadius = ringIndex < config.rings.length - 1 ? config.rings[ringIndex + 1].radius : 0;
                        
                        // Convert degrees to radians for SVG arc
                        const startRad = (startAngle - 90) * Math.PI / 180;
                        const endRad = (endAngle - 90) * Math.PI / 180;
                        
                        // Calculate points
                        const x1 = config.centerX + innerRadius * Math.cos(startRad);
                        const y1 = config.centerY + innerRadius * Math.sin(startRad);
                        const x2 = config.centerX + outerRadius * Math.cos(startRad);
                        const y2 = config.centerY + outerRadius * Math.sin(startRad);
                        const x3 = config.centerX + outerRadius * Math.cos(endRad);
                        const y3 = config.centerY + outerRadius * Math.sin(endRad);
                        const x4 = config.centerX + innerRadius * Math.cos(endRad);
                        const y4 = config.centerY + innerRadius * Math.sin(endRad);
                        
                        // Create path for arc
                        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        
                        const largeArcFlag = endAngle - startAngle > 180 ? 1 : 0;
                        
                        // Define SVG path
                        const d = [
                            `M ${x2} ${y2}`,
                            `A ${outerRadius} ${outerRadius} 0 ${largeArcFlag} 1 ${x3} ${y3}`,
                            `L ${x4} ${y4}`,
                            `A ${innerRadius} ${innerRadius} 0 ${largeArcFlag} 0 ${x1} ${y1}`,
                            "Z"
                        ].join(" ");
                        
                        path.setAttribute("d", d);
                        path.setAttribute("fill", ring.color);
                        path.classList.add("segment");
                        path.dataset.name = ring.segmentNames[i];
                        path.dataset.ring = ring.name;
                        
                        // Slightly lighten or darken segments for better visibility
                        const brightness = 1 + (i % 2 === 0 ? 0.15 : -0.15);
                        path.style.filter = `brightness(${brightness})`;
                        
                        path.addEventListener("mousemove", showTooltip);
                        path.addEventListener("mouseleave", hideTooltip);
                        path.addEventListener("click", function() {
                            showSidebar(ringIndex, i);
                        });
                        
                        svg.appendChild(path);
                    }
                }
            });
            
            // Create legend
            createLegend();
        }
        
        function createLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = '';
            
            config.rings.forEach(ring => {
                ring.segmentNames.forEach((name, i) => {
                    const item = document.createElement('div');
                    item.className = 'legend-item';
                    
                    const colorBox = document.createElement('div');
                    colorBox.className = 'legend-color';
                    colorBox.style.backgroundColor = ring.color;
                    
                    // Apply the same brightness filter as in the chart
                    if (ring.segments > 1) {
                        const brightness = 1 + (i % 2 === 0 ? 0.15 : -0.15);
                        colorBox.style.filter = `brightness(${brightness})`;
                    }
                    
                    const label = document.createElement('span');
                    label.textContent = name;
                    
                    item.appendChild(colorBox);
                    item.appendChild(label);
                    legend.appendChild(item);
                });
            });
        }
        
        function showTooltip(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = 1;
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY + 10 + 'px';
            
            const segment = event.target;
            tooltip.textContent = `${segment.dataset.ring}: ${segment.dataset.name}`;
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = 0;
        }
        
        // Function to show sidebar with content
        function showSidebar(ringIndex, segmentIndex) {
            const sidebar = document.getElementById('sidebar');
            const sidebarContent = document.getElementById('sidebar-content');
            
            // Get content for this segment
            const ring = config.rings[ringIndex];
            const content = ring.segmentContent[segmentIndex];
            
            // Create content HTML
            sidebarContent.innerHTML = `
                <button class="sidebar-close" id="close-sidebar">&times;</button>
                <h2 class="sidebar-title">${content.title}</h2>
                <h3 class="sidebar-subtitle">${content.subtitle}</h3>
                <img class="sidebar-image" src="${content.imageSrc}" alt="${content.title}">
                <p class="sidebar-text">${content.text}</p>
            `;
            
            // Show sidebar
            sidebar.classList.add('active');
            
            // Add event listener to close button
            document.getElementById('close-sidebar').addEventListener('click', closeSidebar);
            
            // Prevent propagation of clicks inside the sidebar
            sidebar.addEventListener('click', function(event) {
                event.stopPropagation();
            });
            
            // Add click event to close sidebar when clicking elsewhere
            setTimeout(() => {
                document.addEventListener('click', closeSidebarOnClickOutside);
            }, 10);
        }
        
        // Function to close sidebar
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.remove('active');
            document.removeEventListener('click', closeSidebarOnClickOutside);
        }
        
        // Function to close sidebar when clicking outside
        function closeSidebarOnClickOutside(event) {
            const sidebar = document.getElementById('sidebar');
            const clickedInsideSidebar = sidebar.contains(event.target);
            const clickedOnSegment = event.target.classList.contains('segment');
            
            if (!clickedInsideSidebar && !clickedOnSegment) {
                closeSidebar();
            }
        }
        
        // Initialize chart
        document.addEventListener('DOMContentLoaded', () => {
            createChart();
            
            // Add event listeners for controls
            document.getElementById('rotate-left').addEventListener('click', () => {
                config.rotation = (config.rotation - 15) % 360;
                createChart();
            });
            
            document.getElementById('rotate-right').addEventListener('click', () => {
                config.rotation = (config.rotation + 15) % 360;
                createChart();
            });
            
            document.getElementById('reset').addEventListener('click', () => {
                config.rotation = 0;
                createChart();
            });
            
            // Make chart responsive to window resizing
            window.addEventListener('resize', () => {
                createChart();
            });
        });
    </script>
</body>
</html>
